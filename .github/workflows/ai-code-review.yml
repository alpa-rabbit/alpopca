name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write 
    
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Claude Code Review
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          direct_prompt: |
            당신은 시니어 개발자입니다. 이 PR을 리뷰해주세요.
            
            ## 프로젝트 컨텍스트
            - Spring Boot 기반 백엔드 / React 프론트엔드
            - 클린 아키텍처 지향
            - 포트폴리오 프로젝트
            
            ## 리뷰 기준
            
            ### 반드시 지적 (🚨)
            - NullPointerException 가능성
            - 예외 처리 누락
            - SQL Injection, XSS 등 보안 취약점
            - 명백한 로직 오류
            
            ### 권장 개선 (💡)
            - 더 나은 네이밍
            - 중복 코드 제거
            - 성능 개선 포인트
            - 테스트 추가 필요한 부분
            
            ### 칭찬할 점 (✅)
            - 좋은 설계나 패턴 사용
            - 가독성 좋은 코드
            
            ## 응답 형식
            
            ### 요약
            한 줄로 전체 평가
            
            ### 주요 피드백
            파일별로 구체적인 라인 언급하며 피드백
            
            ### 질문
            의도가 불분명한 부분 질문
            
            ---
            
            사소한 스타일 이슈는 무시하고, 중요한 것만 집중해주세요.
            전체 피드백은 5개 이내로 제한해주세요.
            한국어로 답변해주세요.
